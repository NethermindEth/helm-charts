############################################
# drpc-nodecore Multi-Project Chart
############################################

# This is to override the chart name.
nameOverride: ""
fullnameOverride: ""

# NodeCore container image
image:
  repository: drpcorg/nodecore
  pullPolicy: IfNotPresent
  tag: "0.1.6"

# Image used for the envsubst init container
initImage:
  repository: bhgedigital/envsubst
  tag: latest

# Secrets for pulling images from a private registry
imagePullSecrets: []

# ──────────────────────────────────────────
# Shared defaults (inherited by all projects unless overridden)
# ──────────────────────────────────────────
defaults:
  replicaCount: 1

  deployment:
    enabled: true
    strategy: {}
    restartOnChanges: true
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 10
      targetCPUUtilizationPercentage: 80
      # targetMemoryUtilizationPercentage: 80

  resources: {}
    # requests:
    #   memory: 1Gi
    #   cpu: "1"
    # limits:
    #   memory: 2Gi
    #   cpu: "2"

  readinessProbe:
    httpGet:
      path: /metrics
      port: 9093
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 5
    failureThreshold: 2
    successThreshold: 1

  livenessProbe:
    tcpSocket:
      port: 9090
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 1
    failureThreshold: 3
    successThreshold: 1

  nodeSelector: {}
  tolerations: []
  affinity: {}

  podSecurityContext:
    fsGroup: 1000
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    seccompProfile:
      type: RuntimeDefault

  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsGroup: 0
    runAsNonRoot: false
    runAsUser: 0
    seccompProfile:
      type: RuntimeDefault

  initContainerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsGroup: 0
    runAsNonRoot: false
    runAsUser: 0
    seccompProfile:
      type: RuntimeDefault

  serviceMonitor:
    enabled: true
    interval: 30s
    # namespace: ""
    # labels: {}
    # annotations: {}
    # scrapeTimeout: ""
    # relabelings: []
    # metricRelabelings: []

  terminationGracePeriodSeconds: 30

# ──────────────────────────────────────────
# Projects
# ──────────────────────────────────────────
# Each key is a project name (must be a valid K8s DNS label: lowercase, alphanumeric, hyphens).
# Each project produces: Deployment, Service, ConfigMap, (optional) HPA, ServiceMonitor.
#
# Secrets are managed out-of-band (InfisicalSecret CRD or ExternalSecret CRD).
# The chart references the resulting K8s Secret by name via `secretRef`.
projects: {}
  # example-project:
  #   # Required: K8s Secret name containing auth token + provider API keys
  #   secretRef: "nodecore-example-project-secret"
  #
  #   # Env var name for the auth token (must exist in the secret)
  #   authTokenEnvVar: "NODECORE_AUTH_TOKEN"
  #
  #   # Additional env vars
  #   env: []
  #   envFrom: []
  #
  #   # Override any defaults
  #   replicaCount: 2
  #   resources:
  #     requests:
  #       memory: 2Gi
  #       cpu: "2"
  #   deployment:
  #     autoscaling:
  #       enabled: true
  #       minReplicas: 2
  #       maxReplicas: 8
  #
  #   # Optional NodeCore config sections (integrity, failsafe, chain-defaults, scoring)
  #   nodecoreConfig:
  #     integrity:
  #       enabled: true
  #     failsafe:
  #       retry:
  #         attempts: 3
  #         delay: 300ms
  #       hedge:
  #         delay: 1s
  #         max: 2
  #     chain-defaults:
  #       options:
  #         internal-timeout: 5s
  #         validation-interval: 30s
  #     scoring:
  #       calculation-interval: 10s
  #
  #   # Required: list of upstream definitions
  #   upstreams:
  #     - id: alchemy-eth
  #       chain: ethereum
  #       connectors:
  #         - type: json-rpc
  #           url: "https://eth-mainnet.g.alchemy.com/v2/${ALCHEMY_API_KEY}"
  #     - id: public-eth
  #       chain: ethereum
  #       connectors:
  #         - type: json-rpc
  #           url: "https://eth.llamarpc.com"
